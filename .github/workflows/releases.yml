name: Act on release created

on:
  release:
    types: [created]

jobs:
  build:
    name: Clone all latest release from all repo
    environment: build_environment
    runs-on: ubuntu-latest
    steps: 
     - uses: actions/checkout@v3
       with:
          repository: venkatkasi/repo2
          fetch-depth: 0

          
     - name: Checkout latest release tag
       run: |
         LATEST_TAG=$(git describe --tags `git rev-list --tags --max-count=1`)
         echo $LATEST_TAG
         git checkout $LATEST_TAG
          
     - uses: actions/checkout@v3
       with:
         repository: venkatkasi/repo3
         fetch-depth: 0

         
     - name: Checkout latest release tag
       run: |
         LATEST_TAG=$(git describe --tags `git rev-list --tags --max-count=1`)
         echo $LATEST_TAG
         git checkout $LATEST_TAG
        
     - uses: actions/checkout@v3
       with:
         repository: venkatkasi/repo4
         fetch-depth: 0

         
     - name: Checkout latest release tag
       run: |
         LATEST_TAG=$(git describe --tags `git rev-list --tags --max-count=1`)
         echo $LATEST_TAG
         git checkout $LATEST_TAG
         mkdir target
         mv . target
         rm -rf target/.git
         git clone https://.:${{ secrets.PAT }}@github.com/mainrepo target
         cd target
         git add .
         git diff-index --quiet HEAD || git commit -m "Automatic publish from github.com/project"
         git push target master

          
       
